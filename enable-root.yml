---
  - name: Create accounts on all nodes
    hosts: all
    remote_user: ec2-user 
    become: yes
    tasks:
    - name: create accounts on duvar
      hosts: duvar
      user:
         name: "{{ item }}"
         state: present
         password: "koublockchain"
         update_password: always
         generate_ssh_key: yes
         ssh_key_type: ed25519
         ssh_key_file: .ssh/id_ed25519
      loop:
         - talhao
         - numanm
         - cuneytk
         - caglayans
         - ranak
         - huseyink
         - yilmazd
         - turguty
    - name:  create accound on nodes 
      hosts: nodes
      user:
         name: "{{ item }}"
         state: present
         password: "koublockchain"
         update_password: always
      loop:
         - talhao
         - numanm
         - cuneytk
         - caglayans
         - ranak
         - huseyink
         - yilmazd
         - turguty
    - name: Copy private key from duvar to nodes
      hosts: nodes
      copy:
         src:  /home/{{ item }}/.ssh/id_ed25519 
         dest: /home/{{ item }}/.ssh/id_ed25519
         remote_src: yes
         owner: "{{ item }}"
         mode: '0600'
      loop:
         - talhao
         - numanm
         - cuneytk
         - caglayans
         - ranak
         - huseyink
         - yilmazd
         - turguty
    - name: Copy public key from duvar to nodes
      hosts: nodes
      copy:
         src: /home/{{ item }}/.ssh/id_ed25519.pub 
         dest: /home/{{ item }}/.ssh/id_ed25519.pub 
         remote_src: yes
         owner: "{{ item }}"
         mode: '0644'
      loop:
         - talhao
         - numanm
         - cuneytk
         - caglayans
         - ranak
         - huseyink
         - yilmazd
         - turguty
